<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Client Escrow Payment</title>
        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    </head>

    <body>
        <h2>Escrow Payment</h2>

        <label for="amount">Enter Amount (INR):</label>
        <input type="number" id="amount" placeholder="Enter Amount" required />

        <button id="pay-btn">Pay Now</button>

        <script>
            document
                .getElementById("pay-btn")
                .addEventListener("click", async () => {
                    const amountInput = document.getElementById("amount");
                    const amount = parseFloat(amountInput.value);

                    if (!amount || amount <= 0) {
                        alert("Please enter a valid amount.");
                        return;
                    }

                    try {
                        const response = await fetch(
                            "http://localhost:8000/api/v1/payment/create",
                            {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json",
                                },
                                body: JSON.stringify({
                                    amount: amount,
                                    project_id: 2,
                                    application_id: 2,
                                    payer_id: 1,
                                    payee_id: 2,
                                    description: `Client payment of ₹${amount} for project`,
                                }),
                            }
                        );

                        const result = await response.json();

                        const razorpayOrder = result.order;
                        const key = ""; //Use your test Razorpay key

                        const options = {
                            key: key,
                            amount: razorpayOrder.amount,
                            currency: "INR",
                            name: "My Freelance Platform",
                            description: "Escrow Payment",
                            order_id: razorpayOrder.id,
                            handler: function (response) {
                                alert("✅ Payment Successful!");
                                console.log("Razorpay Response:", response);
                                // Razorpay webhook will update your backend automatically
                            },
                            prefill: {
                                name: "Client",
                                email: "client@example.com",
                                contact: "9999999999",
                            },
                            theme: {
                                color: "#3399cc",
                            },
                        };

                        const rzp = new Razorpay(options);
                        rzp.open();
                    } catch (error) {
                        console.error("Payment Error:", error);
                        alert("Something went wrong. Please try again.");
                    }
                });
        </script>
    </body>
</html>
